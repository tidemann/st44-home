<div class="auth-container">
  <div class="auth-card">
    <!-- Logo -->
    <div class="auth-logo">
      <div class="auth-logo-text">Diddit!</div>
    </div>

    <!-- Title -->
    <h1 class="auth-title">Create Account</h1>
    <p class="auth-subtitle">Start managing your household today</p>

    <!-- Google Sign-Up Button -->
    @if (googleClientId) {
      <div class="google-signin-wrapper">
        <div
          id="g_id_onload_register"
          [attr.data-client_id]="googleClientId"
          data-context="signup"
          data-ux_mode="popup"
          data-callback="handleGoogleSignUp"
          data-auto_prompt="false"
        ></div>
        <div
          class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="outline"
          data-text="signup_with"
          data-size="large"
          data-logo_alignment="left"
        ></div>
      </div>

      <div class="divider">
        <span>OR</span>
      </div>
    }

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Name fields - side by side on larger screens -->
      <div class="name-fields">
        <!-- First Name -->
        <div class="form-group">
          <label for="firstName" class="form-label">First Name</label>
          <input
            id="firstName"
            type="text"
            class="form-input"
            formControlName="firstName"
            placeholder="First name"
            [attr.aria-invalid]="firstNameControl.invalid && firstNameControl.touched"
            [attr.aria-describedby]="
              firstNameControl.invalid && firstNameControl.touched ? 'firstName-error' : null
            "
          />
          @if (firstNameControl.invalid && firstNameControl.touched) {
            <div id="firstName-error" class="error" role="alert">
              @if (firstNameControl.errors?.['required']) {
                <span>First name is required</span>
              }
              @if (firstNameControl.errors?.['maxlength']) {
                <span>First name is too long</span>
              }
            </div>
          }
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="lastName" class="form-label">Last Name</label>
          <input
            id="lastName"
            type="text"
            class="form-input"
            formControlName="lastName"
            placeholder="Last name"
            [attr.aria-invalid]="lastNameControl.invalid && lastNameControl.touched"
            [attr.aria-describedby]="
              lastNameControl.invalid && lastNameControl.touched ? 'lastName-error' : null
            "
          />
          @if (lastNameControl.invalid && lastNameControl.touched) {
            <div id="lastName-error" class="error" role="alert">
              @if (lastNameControl.errors?.['required']) {
                <span>Last name is required</span>
              }
              @if (lastNameControl.errors?.['maxlength']) {
                <span>Last name is too long</span>
              }
            </div>
          }
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input
          id="email"
          type="email"
          class="form-input"
          formControlName="email"
          placeholder="you@example.com"
          [attr.aria-invalid]="emailControl.invalid && emailControl.touched"
          [attr.aria-describedby]="
            emailControl.invalid && emailControl.touched ? 'email-error' : null
          "
        />
        @if (emailControl.invalid && emailControl.touched) {
          <div id="email-error" class="error" role="alert">
            @if (emailControl.errors?.['required']) {
              <span>Email is required</span>
            }
            @if (emailControl.errors?.['email']) {
              <span>Please enter a valid email</span>
            }
          </div>
        }
      </div>

      <!-- Password -->
      <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <div class="password-input-wrapper">
          <input
            id="password"
            [type]="showPassword() ? 'text' : 'password'"
            class="form-input"
            formControlName="password"
            placeholder="Create a strong password"
            [attr.aria-invalid]="passwordControl.invalid && passwordControl.touched"
            [attr.aria-describedby]="
              'password-strength' +
              (passwordControl.invalid && passwordControl.touched ? ' password-error' : '')
            "
          />
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'"
          >
            {{ showPassword() ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>

        @if (passwordControl.value) {
          <div id="password-strength" class="strength-indicator" aria-live="polite">
            Strength:
            <span [class]="'strength-' + passwordStrength()">{{ passwordStrength() }}</span>
          </div>
        }

        @if (passwordControl.invalid && passwordControl.touched) {
          <div id="password-error" class="error" role="alert">
            Password must be at least 8 characters with uppercase, lowercase, and number
          </div>
        }
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label for="confirmPassword" class="form-label">Confirm Password</label>
        <input
          id="confirmPassword"
          [type]="showPassword() ? 'text' : 'password'"
          class="form-input"
          formControlName="confirmPassword"
          placeholder="Confirm your password"
          [attr.aria-invalid]="confirmPasswordControl.invalid && confirmPasswordControl.touched"
          [attr.aria-describedby]="
            confirmPasswordControl.invalid && confirmPasswordControl.touched
              ? 'confirm-error'
              : null
          "
        />
        @if (registerForm.errors?.['passwordMismatch'] && confirmPasswordControl.touched) {
          <div id="confirm-error" class="error" role="alert">Passwords do not match</div>
        }
      </div>

      <!-- Server Error -->
      @if (errorMessage()) {
        <div class="error server-error" role="alert" aria-live="assertive">
          {{ errorMessage() }}
        </div>
      }

      <!-- Submit -->
      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="registerForm.invalid || isLoading()"
      >
        @if (isLoading()) {
          <span>Creating account...</span>
        } @else {
          <span>Create Account</span>
        }
      </button>

      <!-- Links -->
      <div class="auth-links">
        Already have an account?
        <a routerLink="/login" class="auth-link">Log in</a>
      </div>
    </form>
  </div>
</div>
