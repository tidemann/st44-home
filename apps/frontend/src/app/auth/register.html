<div class="auth-container">
  <div class="auth-card">
    <!-- Logo -->
    <div class="auth-logo">
      <div class="auth-logo-text">Diddit!</div>
    </div>

    <!-- Title -->
    <h1 class="auth-title" i18n="@@register.title">Opprett konto</h1>
    <p class="auth-subtitle" i18n="@@register.subtitle">
      Begynn √• administrere husholdningen din i dag
    </p>

    <!-- Google Sign-Up Button -->
    @if (googleClientId) {
      <div class="google-signin-wrapper">
        <div
          id="g_id_onload_register"
          [attr.data-client_id]="googleClientId"
          data-context="signup"
          data-ux_mode="popup"
          data-callback="handleGoogleSignUp"
          data-auto_prompt="false"
        ></div>
        <div
          class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="outline"
          data-text="signup_with"
          data-size="large"
          data-logo_alignment="left"
        ></div>
      </div>

      <div class="divider">
        <span i18n="@@common.or">ELLER</span>
      </div>
    }

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Name fields - side by side on larger screens -->
      <div class="name-fields">
        <!-- First Name -->
        <div class="form-group">
          <label for="firstName" class="form-label" i18n="@@register.firstName.label"
            >Fornavn</label
          >
          <input
            id="firstName"
            type="text"
            class="form-input"
            formControlName="firstName"
            i18n-placeholder="@@register.firstName.placeholder"
            placeholder="Fornavn"
            [attr.aria-invalid]="firstNameControl.invalid && firstNameControl.touched"
            [attr.aria-describedby]="
              firstNameControl.invalid && firstNameControl.touched ? 'firstName-error' : null
            "
          />
          @if (firstNameControl.invalid && firstNameControl.touched) {
            <div id="firstName-error" class="error" role="alert">
              @if (firstNameControl.errors?.['required']) {
                <span i18n="@@error.firstName.required">Fornavn er p√•krevd</span>
              }
              @if (firstNameControl.errors?.['maxlength']) {
                <span i18n="@@error.firstName.tooLong">Fornavnet er for langt</span>
              }
            </div>
          }
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="lastName" class="form-label" i18n="@@register.lastName.label"
            >Etternavn</label
          >
          <input
            id="lastName"
            type="text"
            class="form-input"
            formControlName="lastName"
            i18n-placeholder="@@register.lastName.placeholder"
            placeholder="Etternavn"
            [attr.aria-invalid]="lastNameControl.invalid && lastNameControl.touched"
            [attr.aria-describedby]="
              lastNameControl.invalid && lastNameControl.touched ? 'lastName-error' : null
            "
          />
          @if (lastNameControl.invalid && lastNameControl.touched) {
            <div id="lastName-error" class="error" role="alert">
              @if (lastNameControl.errors?.['required']) {
                <span i18n="@@error.lastName.required">Etternavn er p√•krevd</span>
              }
              @if (lastNameControl.errors?.['maxlength']) {
                <span i18n="@@error.lastName.tooLong">Etternavnet er for langt</span>
              }
            </div>
          }
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email" class="form-label" i18n="@@register.email.label">E-post</label>
        <input
          id="email"
          type="email"
          class="form-input"
          formControlName="email"
          i18n-placeholder="@@register.email.placeholder"
          placeholder="deg@eksempel.no"
          [attr.aria-invalid]="emailControl.invalid && emailControl.touched"
          [attr.aria-describedby]="
            emailControl.invalid && emailControl.touched ? 'email-error' : null
          "
        />
        @if (emailControl.invalid && emailControl.touched) {
          <div id="email-error" class="error" role="alert">
            @if (emailControl.errors?.['required']) {
              <span i18n="@@error.email.required">E-post er p√•krevd</span>
            }
            @if (emailControl.errors?.['email']) {
              <span i18n="@@error.email.invalid">Vennligst oppgi en gyldig e-postadresse</span>
            }
          </div>
        }
      </div>

      <!-- Password -->
      <div class="form-group">
        <label for="password" class="form-label" i18n="@@register.password.label">Passord</label>
        <div class="password-input-wrapper">
          <input
            id="password"
            [type]="showPassword() ? 'text' : 'password'"
            class="form-input"
            formControlName="password"
            i18n-placeholder="@@register.password.placeholder"
            placeholder="Opprett et sterkt passord"
            [attr.aria-invalid]="passwordControl.invalid && passwordControl.touched"
            [attr.aria-describedby]="
              'password-strength' +
              (passwordControl.invalid && passwordControl.touched ? ' password-error' : '')
            "
          />
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword() ? 'Skjul passord' : 'Vis passord'"
          >
            {{ showPassword() ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>

        @if (passwordControl.value) {
          <div id="password-strength" class="strength-indicator" aria-live="polite">
            <ng-container i18n="@@register.password.strength">Styrke:</ng-container>
            <span [class]="'strength-' + passwordStrength()">{{ passwordStrength() }}</span>
          </div>
        }

        @if (passwordControl.invalid && passwordControl.touched) {
          <div id="password-error" class="error" role="alert" i18n="@@error.password.requirements">
            Passordet m√• v√¶re minst 8 tegn med store bokstaver, sm√• bokstaver og tall
          </div>
        }
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label for="confirmPassword" class="form-label" i18n="@@register.confirmPassword.label"
          >Bekreft passord</label
        >
        <input
          id="confirmPassword"
          [type]="showPassword() ? 'text' : 'password'"
          class="form-input"
          formControlName="confirmPassword"
          i18n-placeholder="@@register.confirmPassword.placeholder"
          placeholder="Bekreft passordet ditt"
          [attr.aria-invalid]="confirmPasswordControl.invalid && confirmPasswordControl.touched"
          [attr.aria-describedby]="
            confirmPasswordControl.invalid && confirmPasswordControl.touched
              ? 'confirm-error'
              : null
          "
        />
        @if (registerForm.errors?.['passwordMismatch'] && confirmPasswordControl.touched) {
          <div id="confirm-error" class="error" role="alert" i18n="@@error.password.mismatch">
            Passordene samsvarer ikke
          </div>
        }
      </div>

      <!-- Server Error -->
      @if (errorMessage()) {
        <div class="error server-error" role="alert" aria-live="assertive">
          {{ errorMessage() }}
        </div>
      }

      <!-- Submit -->
      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="registerForm.invalid || isLoading()"
      >
        @if (isLoading()) {
          <span i18n="@@register.submit.loading">Oppretter konto...</span>
        } @else {
          <span i18n="@@register.submit.button">Opprett konto</span>
        }
      </button>

      <!-- Links -->
      <div class="auth-links">
        <ng-container i18n="@@register.hasAccount">Har du allerede en konto?</ng-container>
        <a routerLink="/login" class="auth-link" i18n="@@register.login">Logg inn</a>
      </div>
    </form>
  </div>
</div>
