<div class="task-dashboard">
  <header class="dashboard-header">
    <h2>Household Tasks</h2>
    <div class="stats">
      <div class="stat">
        <span class="value">{{ completionRate() }}%</span>
        <span class="label">Completion Rate</span>
      </div>
      <div class="stat">
        <span class="value">{{ overdueCount() }}</span>
        <span class="label">Overdue</span>
      </div>
    </div>
  </header>

  <div class="filters">
    <select
      class="child-filter"
      [value]="selectedChild()"
      (change)="onChildChange($event)"
      aria-label="Filter by child"
    >
      <option value="">All Children</option>
      @for (child of children(); track child.id) {
        <option [value]="child.id">{{ child.name }}</option>
      }
    </select>

    <select
      class="status-filter"
      [value]="selectedStatus()"
      (change)="onStatusChange($event)"
      aria-label="Filter by status"
    >
      <option value="">All Status</option>
      <option value="pending">Pending</option>
      <option value="completed">Completed</option>
      <option value="overdue">Overdue</option>
    </select>

    <div class="date-buttons" role="group" aria-label="Date range filter">
      <button
        (click)="filterByDate('today')"
        [class.active]="dateFilter() === 'today'"
        aria-pressed="{{ dateFilter() === 'today' }}"
      >
        Today
      </button>
      <button
        (click)="filterByDate('week')"
        [class.active]="dateFilter() === 'week'"
        aria-pressed="{{ dateFilter() === 'week' }}"
      >
        This Week
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading" role="status" aria-live="polite">
      <p>Loading assignments...</p>
    </div>
  }

  @if (error()) {
    <div class="error" role="alert" aria-live="assertive">
      <p>{{ error() }}</p>
    </div>
  }

  @if (filteredAssignments().length === 0 && !loading()) {
    <div class="empty-state">
      <p>No tasks found for selected filters</p>
    </div>
  }

  <div class="assignments-grid">
    @for (assignment of filteredAssignments(); track assignment.id) {
      <div class="assignment-card">
        <div class="task-info">
          <h3>{{ assignment.title }}</h3>
          <p class="child-name">{{ assignment.childName }}</p>
          @if (assignment.description) {
            <p class="description">{{ assignment.description }}</p>
          }
        </div>

        <div class="task-meta">
          <span class="date">{{ formatDate(assignment.date) }}</span>
          <span class="status-badge {{ assignment.status }}">
            {{ assignment.status }}
          </span>
        </div>

        <div class="actions">
          @if (assignment.status === 'pending') {
            <button
              class="reassign-button"
              (click)="openReassignModal(assignment)"
              [attr.aria-label]="'Reassign ' + assignment.title + ' to different child'"
            >
              Reassign
            </button>
          }
        </div>
      </div>
    }
  </div>
</div>

@if (showReassignModal()) {
  <app-reassign-modal
    [assignment]="selectedAssignment()!"
    [children]="children()"
    (reassign)="onReassign($event)"
    (closeModal)="closeReassignModal()"
  />
}
