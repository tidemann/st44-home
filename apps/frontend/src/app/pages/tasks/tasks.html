<app-page title="All Tasks" maxWidth="medium">
  <!-- Filter Tabs -->
  <div class="filter-tabs">
    @for (tab of filterTabs(); track tab.id) {
      <button
        type="button"
        class="filter-tab"
        [class.active]="activeFilter() === tab.id"
        (click)="onFilterClick(tab.id)"
        [attr.aria-pressed]="activeFilter() === tab.id"
        [attr.aria-label]="'Filter by ' + tab.label"
      >
        {{ tab.label }}
      </button>
    }
  </div>

  <!-- Person Filter Tabs (only shown when filter = 'person') -->
  @if (activeFilter() === 'person') {
    <div class="person-tabs" role="tablist" aria-label="Filter by person">
      @for (member of members(); track member.id) {
        <button
          type="button"
          role="tab"
          class="person-tab"
          [class.active]="selectedPersonId() === member.id"
          [attr.aria-selected]="selectedPersonId() === member.id"
          [attr.aria-label]="'View tasks for ' + member.name"
          (click)="onPersonSelect(member.id)"
        >
          {{ member.name }}
        </button>
      }
      @if (members().length === 0) {
        <p class="no-members-message">No children in this household.</p>
      }
    </div>
  }

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state" role="status" aria-live="polite">
      <div class="loading-spinner" aria-hidden="true"></div>
      <p class="loading-text">Loading tasks...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="error-state" role="alert" aria-live="assertive">
      <div class="error-icon" aria-hidden="true">!</div>
      <p class="error-text">{{ error() }}</p>
      <button type="button" class="retry-button" (click)="loadTasks()">Retry</button>
    </div>
  }

  <!-- Task List -->
  @if (!loading() && !error()) {
    <div class="task-list">
      @if (filteredTasks().length === 0) {
        <!-- Empty State -->
        <div class="empty-state" role="status">
          <div class="empty-icon" aria-hidden="true">ðŸ“‹</div>
          <p class="empty-text">{{ emptyMessage() }}</p>
        </div>
      } @else {
        <!-- Task Cards -->
        @for (task of filteredTasks(); track task.id) {
          <app-task-card
            [task]="task"
            [showCompleteButton]="!isParentOrAdmin()"
            [clickable]="true"
            [showReassignButton]="activeFilter() !== 'all'"
            (complete)="onTaskComplete($event)"
            (edit)="onTaskEdit($event)"
            (reassign)="onTaskReassign($event)"
          />
        }
      }
    </div>
  }

  <!-- Edit Task Modal -->
  <app-task-form-modal
    [open]="editModalOpen()"
    mode="edit"
    [task]="editingTask()"
    [children]="members()"
    (closeRequested)="onModalClose()"
    (formSubmitted)="onTaskUpdate($event)"
    (taskDeleted)="onTaskDelete()"
  />

  <!-- Reassign Task Modal -->
  <app-reassign-task-modal
    [open]="reassignModalOpen()"
    [taskName]="reassigningAssignment()?.title ?? ''"
    [currentChildId]="reassigningAssignment()?.childId ?? null"
    [children]="members()"
    (closeRequested)="onReassignModalClose()"
    (reassigned)="onReassignConfirm($event)"
  />
</app-page>
