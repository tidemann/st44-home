<!-- Loading State -->
@if (loading()) {
  <div class="loading-container" role="status" aria-live="polite">
    <div class="loading-spinner" aria-hidden="true"></div>
    <p i18n="@@progress.loading">Laster fremgang...</p>
  </div>
}

<!-- Error State -->
@if (error()) {
  <div class="error-container" role="alert" aria-live="assertive">
    <p class="error-message">{{ error() }}</p>
    <button class="retry-button" (click)="loadData()" i18n="@@progress.tryAgain">Prøv igjen</button>
  </div>
}

<!-- Main Content -->
@if (!loading() && !error()) {
  <app-page i18n-title="@@progress.pageTitle" title="Fremgang" maxWidth="wide">
    <!-- Household Stats Section -->
    <section class="stats-section" aria-labelledby="stats-heading">
      <h2 id="stats-heading" class="visually-hidden" i18n="@@progress.statsHeading">
        Husstandsstatistikk
      </h2>
      <div class="stats-grid" role="list">
        <div
          class="stat-box"
          role="listitem"
          aria-label="Total Points: {{ householdStats().totalPoints }}"
        >
          <div class="stat-value">{{ householdStats().totalPoints }}</div>
          <div class="stat-label" i18n="@@progress.totalPoints">Totalt poeng</div>
        </div>
        <div
          class="stat-box"
          role="listitem"
          aria-label="Completion Rate: {{ householdStats().completionRate }} percent"
        >
          <div class="stat-value">{{ householdStats().completionRate }}%</div>
          <div class="stat-label" i18n="@@progress.completionRate">Fullføringsrate</div>
        </div>
        <div
          class="stat-box"
          role="listitem"
          aria-label="Tasks This Week: {{ householdStats().tasksCompletedThisWeek }}"
        >
          <div class="stat-value">{{ householdStats().tasksCompletedThisWeek }}</div>
          <div class="stat-label" i18n="@@progress.tasksThisWeek">Oppgaver denne uken</div>
        </div>
      </div>
    </section>

    <!-- Leaderboard Section -->
    <section class="section" aria-labelledby="leaderboard-heading">
      <div class="section-header">
        <h2 id="leaderboard-heading" i18n="@@progress.leaderboardTitle">Ukens ledere</h2>
        <p class="section-subtitle" i18n="@@progress.leaderboardSubtitle">
          Bra jobba, alle sammen!
        </p>
      </div>

      @if (hasLeaderboard()) {
        <ol
          class="leaderboard"
          i18n-aria-label="@@progress.leaderboardAriaLabel"
          aria-label="Ukentlig toppliste"
        >
          @for (entry of leaderboard(); track entry.userId) {
            <li
              class="leaderboard-item"
              [class.current-user]="entry.isCurrentUser"
              [attr.aria-current]="entry.isCurrentUser ? 'true' : null"
            >
              <div class="leaderboard-rank" aria-hidden="true">
                {{ getMedalForRank(entry.rank) }}
              </div>
              <div class="leaderboard-info">
                <div class="leaderboard-name">{{ entry.name }}</div>
                <div class="leaderboard-tasks">
                  <ng-container i18n="@@progress.tasksCompleted"
                    >{{ entry.tasksCompleted }} oppgaver fullført</ng-container
                  >
                </div>
              </div>
              <div class="leaderboard-points" aria-label="{{ entry.points }} points">
                {{ entry.points }}
              </div>
            </li>
          }
        </ol>
      } @else {
        <div class="empty-state" role="status">
          <p i18n="@@progress.noLeaderboardData">
            Ingen toppliste-data ennå. Fullfør noen oppgaver for å komme i gang!
          </p>
        </div>
      }
    </section>

    <!-- Achievements Section -->
    <section class="section" aria-labelledby="achievements-heading">
      <div class="section-header">
        <h2 id="achievements-heading" i18n="@@progress.achievementsTitle">Prestasjoner</h2>
        <p class="section-subtitle" i18n="@@progress.achievementsSubtitle">
          Fortsett den flotte innsatsen!
        </p>
      </div>

      @if (hasAchievements()) {
        <div
          class="achievements-grid"
          role="list"
          i18n-aria-label="@@progress.achievementBadges"
          aria-label="Prestasjonsbadger"
        >
          @for (achievement of achievements(); track achievement.id) {
            <article
              class="achievement-card"
              [class.unlocked]="achievement.unlocked"
              [class.locked]="!achievement.unlocked"
              role="listitem"
              [attr.aria-label]="
                achievement.name + (achievement.unlocked ? ' - Unlocked' : ' - Locked')
              "
            >
              <div class="achievement-icon" aria-hidden="true">{{ achievement.icon }}</div>
              <div class="achievement-info">
                <h3>{{ achievement.name }}</h3>
                <div class="achievement-desc">{{ achievement.description }}</div>
                @if (!achievement.unlocked && achievement.progress !== undefined) {
                  <div class="achievement-progress">
                    <div
                      class="progress-bar"
                      role="progressbar"
                      [attr.aria-valuenow]="achievement.progress"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      [attr.aria-label]="'Progress: ' + achievement.progress + ' percent'"
                    >
                      <div class="progress-fill" [style.width.%]="achievement.progress"></div>
                    </div>
                    <div class="progress-text" aria-hidden="true">{{ achievement.progress }}%</div>
                  </div>
                }
                @if (achievement.unlocked) {
                  <div class="achievement-unlocked" i18n="@@progress.unlocked">Låst opp!</div>
                }
              </div>
            </article>
          }
        </div>
      } @else {
        <div class="empty-state" role="status">
          <p i18n="@@progress.noAchievementsYet">
            Ingen prestasjoner ennå. Begynn å fullføre oppgaver for å låse opp badges!
          </p>
        </div>
      }
    </section>
  </app-page>
}
