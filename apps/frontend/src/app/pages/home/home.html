<!-- Loading State -->
@if (loading()) {
  <div class="loading-container" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p i18n="@@home.loading">Laster dashboardet ditt...</p>
  </div>
}

<!-- Error State -->
@if (error() && !loading()) {
  <div class="error-container" role="alert" aria-live="assertive">
    <div class="error-icon" aria-hidden="true">!</div>
    <h2 i18n="@@home.errorTitle">Oops!</h2>
    <p>{{ error() }}</p>
    <button class="btn-retry" (click)="loadData()" i18n="@@home.tryAgain">PrÃ¸v igjen</button>
  </div>
}

<!-- Main Content -->
@if (!loading() && !error()) {
  <div class="home-page">
    <!-- Header with Gradient -->
    <header class="header">
      <div class="header-content">
        <div class="greeting-section">
          <h2 class="greeting">{{ greeting() }}, {{ userName() }}!</h2>
          <p class="subtitle" i18n="@@home.subtitle">La oss fÃ¥ gjort oppgavene i dag</p>
        </div>
      </div>
    </header>

    <!-- Content -->
    <div class="content">
      <!-- Failed/Expired Tasks Alert -->
      @if (householdId()) {
        <app-failed-tasks-section [householdId]="householdId()!" />
      }

      <!-- Stats Grid -->
      <div class="stats-grid">
        <app-stat-card
          [icon]="'ðŸŽ¯'"
          [value]="stats().activeCount"
          i18n-label="@@home.stats.active"
          [label]="'Aktive'"
        />
        <app-stat-card
          [icon]="'ðŸ“Š'"
          [value]="stats().weekProgress + '%'"
          i18n-label="@@home.stats.week"
          [label]="'Uke'"
        />
        <app-stat-card
          [icon]="'â­'"
          [value]="stats().totalPoints"
          i18n-label="@@home.stats.points"
          [label]="'Poeng'"
        />
      </div>

      <!-- Analytics Section -->
      @if (analytics()) {
        <div class="analytics-section">
          <app-week-comparison [comparison]="analytics()!.periodComparison" />
          @if (analytics()!.childrenProgress.length > 0) {
            <app-children-trends [childrenProgress]="analytics()!.childrenProgress" />
          }
        </div>
      }

      <!-- Today's Tasks Section -->
      <section class="tasks-section">
        <div class="section-header">
          <h2 i18n="@@home.todaysTasks">Dagens oppgaver</h2>
        </div>

        @if (hasTodayTasks()) {
          <div class="task-list">
            @for (task of todayTasks(); track task.id) {
              <app-task-card
                [task]="task"
                [showCompleteButton]="true"
                [clickable]="true"
                (complete)="onCompleteTask($event)"
                (edit)="onEditTask($event)"
              />
            }
          </div>
        } @else {
          <div class="empty-state" role="status">
            <div class="empty-icon" aria-hidden="true">ðŸ“‹</div>
            <h3 i18n="@@home.noTasksToday">Ingen oppgaver i dag</h3>
            <p i18n="@@home.noTasksTodayDescription">
              Ingen oppgaver er planlagt for i dag. Opprett oppgaver i Oppgaver-seksjonen.
            </p>
          </div>
        }
      </section>

      <!-- Coming Up Section -->
      @if (hasUpcomingTasks()) {
        <section class="tasks-section">
          <div class="section-header">
            <h2 i18n="@@home.comingUp">Kommende</h2>
          </div>
          <div class="task-list">
            @for (task of upcomingTasks(); track task.id) {
              <app-task-card
                [task]="task"
                [showCompleteButton]="false"
                [clickable]="true"
                (edit)="onEditTask($event)"
              />
            }
          </div>
        </section>
      }
    </div>

    <!-- Edit Task Modal -->
    <app-task-form-modal
      [open]="editTaskOpen()"
      mode="edit"
      [task]="selectedTask()"
      [children]="children()"
      (closeRequested)="closeEditTask()"
      (formSubmitted)="onTaskUpdated($event)"
      (taskDeleted)="onTaskDeleted()"
    />

    <!-- Celebration Animation -->
    <app-celebration [show]="showCelebrationAnimation()" (dismissed)="onCelebrationDismissed()" />
  </div>
}
