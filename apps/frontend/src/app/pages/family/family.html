<!-- Loading State -->
@if (loading()) {
  <div class="loading-container" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p>Loading family members...</p>
  </div>
}

<!-- Error State -->
@if (error() && !loading()) {
  <div class="error-container" role="alert" aria-live="assertive">
    <div class="error-icon" aria-hidden="true">!</div>
    <h2>Oops!</h2>
    <p>{{ error() }}</p>
    <button class="btn-retry" (click)="loadData()">Try Again</button>
  </div>
}

<!-- Main Content -->
@if (!loading() && !error()) {
  <div class="family-page">
    <!-- Header with Gradient -->
    <header class="header">
      <div class="header-content">
        <h1 class="logo">Diddit!</h1>
      </div>
    </header>

    <!-- Content -->
    <div class="content">
      <!-- Household Info Section -->
      <div class="household-info">
        <div class="household-details">
          <h2 class="household-name">{{ householdName() }}</h2>
          <div class="household-count">{{ memberCount() }} members</div>
        </div>
      </div>

      <!-- Action Buttons Section -->
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="openInviteModal()">+ Invite Member</button>
        <button class="btn btn-primary" (click)="openAddChildModal()">+ Add Child</button>
      </div>

      <!-- Family Members Section -->
      <section class="members-section">
        <div class="section-header">
          <h2>Family Members</h2>
        </div>

        @if (members().length > 0) {
          <div class="member-list">
            @for (member of members(); track member.id) {
              <app-member-card
                [member]="member"
                [showStats]="true"
                [clickable]="isChildMember(member)"
                (cardClick)="onMemberClick($event)"
              />
            }
          </div>
        } @else {
          <div class="empty-state" role="status">
            <div class="empty-icon" aria-hidden="true">people</div>
            <h3>No members yet</h3>
            <p>Start inviting family members to your household.</p>
          </div>
        }
      </section>
    </div>

    <!-- Modals -->
    <app-invite-modal
      [open]="inviteModalOpen()"
      (closeRequested)="closeInviteModal()"
      (inviteSent)="onInviteSent($event)"
    />

    <app-add-child-modal
      [open]="addChildModalOpen()"
      (closeRequested)="closeAddChildModal()"
      (childAdded)="onChildAdded($event)"
    />

    @if (householdId()) {
      <app-child-details-modal
        [open]="childDetailsModalOpen()"
        [child]="selectedChild()"
        [childEmail]="selectedChildEmail()"
        [householdId]="householdId()!"
        (closeRequested)="closeChildDetailsModal()"
        (accountCreated)="onChildAccountCreated()"
      />
    }
  </div>
}
