<!-- Loading State -->
@if (loading()) {
  <div class="loading-container" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p i18n="@@family.loading">Laster familiemedlemmer...</p>
  </div>
}

<!-- Error State -->
@if (error() && !loading()) {
  <div class="error-container" role="alert" aria-live="assertive">
    <div class="error-icon" aria-hidden="true">!</div>
    <h2 i18n="@@family.errorTitle">Oops!</h2>
    <p>{{ error() }}</p>
    <button class="btn-retry" (click)="loadData()" i18n="@@family.tryAgain">PrÃ¸v igjen</button>
  </div>
}

<!-- Main Content -->
@if (!loading() && !error()) {
  <app-page [title]="householdName()" [subtitle]="memberCount() + ' medlemmer'" maxWidth="wide">
    <!-- Header Actions -->
    <ng-container page-actions>
      <button class="btn btn-header" (click)="openInviteModal()" i18n="@@family.inviteButton">
        + Inviter
      </button>
      <button class="btn btn-header" (click)="openAddChildModal()" i18n="@@family.addChildButton">
        + Legg til barn
      </button>
    </ng-container>

    <!-- Family Members Section -->
    <section class="members-section">
      <div class="section-header">
        <h2 i18n="@@family.membersTitle">Familiemedlemmer</h2>
      </div>

      @if (members().length > 0) {
        <div class="member-list">
          @for (member of members(); track member.id) {
            <div class="member-row">
              <app-member-card
                [member]="member"
                [showStats]="true"
                [clickable]="isChildMember(member)"
                (cardClick)="onMemberClick($event)"
              />
              @if (isChildMember(member)) {
                <button
                  class="btn btn-qr"
                  (click)="openQrCodeModal(member.id)"
                  i18n-aria-label="@@family.qrCodeAriaLabel"
                  aria-label="Vis innloggings-QR-kode for {{ member.name }}"
                  i18n-title="@@family.qrCodeTitle"
                  title="Generer barneinnloggings-QR-kode"
                  i18n="@@family.qrCodeButton"
                >
                  ğŸ“± Barneinnloggings-QR
                </button>
              }
            </div>
          }
        </div>
      } @else {
        <div class="empty-state" role="status">
          <div class="empty-icon" aria-hidden="true">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
          <h3 i18n="@@family.noMembersTitle">Ingen medlemmer ennÃ¥</h3>
          <p i18n="@@family.noMembersDescription">
            Begynn Ã¥ invitere familiemedlemmer til husstanden din.
          </p>
        </div>
      }
    </section>

    <!-- Modals -->
    <app-invite-modal
      [open]="inviteModalOpen()"
      (closeRequested)="closeInviteModal()"
      (inviteSent)="onInviteSent($event)"
    />

    <app-add-child-modal
      [open]="addChildModalOpen()"
      (closeRequested)="closeAddChildModal()"
      (childAdded)="onChildAdded($event)"
    />

    @if (householdId()) {
      <app-child-details-modal
        [open]="childDetailsModalOpen()"
        [child]="selectedChild()"
        [childEmail]="selectedChildEmail()"
        [householdId]="householdId()!"
        (closeRequested)="closeChildDetailsModal()"
        (accountCreated)="onChildAccountCreated()"
        (childUpdated)="onChildUpdated()"
        (childDeleted)="onChildDeleted()"
      />
    }

    @if (qrCodeChildId()) {
      <app-qr-code-modal
        [open]="qrCodeModalOpen()"
        [childId]="qrCodeChildId()"
        [childName]="qrCodeChildName()"
        (closeRequested)="closeQrCodeModal()"
      />
    }
  </app-page>
}
