<div class="create-account-modal">
  <div class="modal-header">
    <h2 i18n="@@createChildAccount.title">Opprett konto for {{ child().name }}</h2>
    <button type="button" class="btn-close" (click)="onCancel()" aria-label="Lukk">&times;</button>
  </div>

  <div class="modal-body">
    <!-- Success Message -->
    @if (successMessage()) {
      <div class="alert alert-success" role="alert">
        {{ successMessage() }}
      </div>
    }

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="alert alert-error" role="alert">
        {{ errorMessage() }}
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Email Field -->
      <div class="form-group">
        <label for="email" i18n="@@createChildAccount.emailLabel">E-postadresse</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          class="form-control"
          [class.invalid]="emailControl.invalid && emailControl.touched"
          i18n-placeholder="@@createChildAccount.emailPlaceholder"
          placeholder="barn@eksempel.no"
          autocomplete="email"
        />
        @if (emailControl.invalid && emailControl.touched) {
          <div class="error-message">
            @if (emailControl.hasError('required')) {
              <ng-container i18n="@@createChildAccount.emailRequired"
                >E-post er pakrevd</ng-container
              >
            }
            @if (emailControl.hasError('email')) {
              <ng-container i18n="@@createChildAccount.emailInvalid"
                >Vennligst oppgi en gyldig e-postadresse</ng-container
              >
            }
          </div>
        }
      </div>

      <!-- Password Field -->
      <div class="form-group">
        <label for="password" i18n="@@createChildAccount.passwordLabel">Passord</label>
        <div class="password-input-wrapper">
          <input
            id="password"
            [type]="showPassword() ? 'text' : 'password'"
            formControlName="password"
            class="form-control"
            [class.invalid]="passwordControl.invalid && passwordControl.touched"
            i18n-placeholder="@@createChildAccount.passwordPlaceholder"
            placeholder="Minimum 8 tegn"
            autocomplete="new-password"
          />
          <button
            type="button"
            class="btn-toggle-password"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword() ? 'Skjul passord' : 'Vis passord'"
          >
            {{ showPassword() ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>

        @if (passwordControl.value && passwordControl.value.length > 0) {
          <div class="password-strength">
            <div class="strength-meter" [class]="passwordStrength().class">
              <div class="strength-bar"></div>
            </div>
            <span class="strength-label">{{ passwordStrength().label }}</span>
          </div>
        }

        @if (passwordControl.invalid && passwordControl.touched) {
          <div class="error-message">
            @if (passwordControl.hasError('required')) {
              <ng-container i18n="@@createChildAccount.passwordRequired"
                >Passord er pakrevd</ng-container
              >
            }
            @if (passwordControl.hasError('minlength')) {
              <ng-container i18n="@@createChildAccount.passwordMinLength"
                >Passordet ma vaere minst 8 tegn</ng-container
              >
            }
            @if (passwordControl.hasError('passwordStrength')) {
              <ng-container i18n="@@createChildAccount.passwordStrength"
                >Passordet ma inneholde store bokstaver, sma bokstaver, tall og
                spesialtegn</ng-container
              >
            }
          </div>
        }
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirmPassword" i18n="@@createChildAccount.confirmPasswordLabel"
          >Bekreft passord</label
        >
        <input
          id="confirmPassword"
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="confirmPassword"
          class="form-control"
          [class.invalid]="
            (confirmPasswordControl.invalid || form.hasError('passwordMismatch')) &&
            confirmPasswordControl.touched
          "
          i18n-placeholder="@@createChildAccount.confirmPasswordPlaceholder"
          placeholder="Skriv inn passordet pa nytt"
          autocomplete="new-password"
        />
        @if (confirmPasswordControl.invalid && confirmPasswordControl.touched) {
          <div class="error-message" i18n="@@createChildAccount.confirmPasswordRequired">
            Bekreft passord er pakrevd
          </div>
        }
        @if (form.hasError('passwordMismatch') && confirmPasswordControl.touched) {
          <div class="error-message" i18n="@@createChildAccount.passwordMismatch">
            Passordene samsvarer ikke
          </div>
        }
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isSubmitting()"
          i18n="@@createChildAccount.cancelButton"
        >
          Avbryt
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="form.invalid || isSubmitting()">
          @if (isSubmitting()) {
            <ng-container i18n="@@createChildAccount.creatingButton"
              >Oppretter konto...</ng-container
            >
          } @else {
            <ng-container i18n="@@createChildAccount.createButton">Opprett konto</ng-container>
          }
        </button>
      </div>
    </form>
  </div>
</div>
