<div class="household-settings">
  @if (isLoading()) {
    <div class="loading" aria-live="polite" i18n="@@householdSettings.loading">
      Laster husholdningsinnstillinger...
    </div>
  } @else if (household()) {
    <div class="household-settings__header">
      <h1 i18n="@@householdSettings.title">Husholdningsinnstillinger</h1>
      <p class="household-settings__subtitle" i18n="@@householdSettings.subtitle">
        Administrer husholdningsdetaljer og medlemmer
      </p>
    </div>

    <div class="household-settings__content">
      <!-- Household Name Section -->
      <section class="settings-section">
        <h2 i18n="@@householdSettings.detailsTitle">Husholdningsdetaljer</h2>

        <form [formGroup]="householdForm" (ngSubmit)="onSubmit()" class="household-form">
          <div class="form-group">
            <label for="household-name" class="form-label" i18n="@@householdSettings.nameLabel"
              >Husholdningsnavn</label
            >
            <input
              id="household-name"
              type="text"
              formControlName="name"
              class="form-input"
              i18n-placeholder="@@householdSettings.namePlaceholder"
              placeholder="f.eks. Familien Hansen"
              [attr.aria-invalid]="
                householdForm.get('name')?.invalid && householdForm.get('name')?.touched
              "
              [attr.aria-describedby]="
                householdForm.get('name')?.invalid && householdForm.get('name')?.touched
                  ? 'name-error'
                  : null
              "
            />

            @if (householdForm.get('name')?.invalid && householdForm.get('name')?.touched) {
              <div id="name-error" class="form-error" role="alert">
                @if (householdForm.get('name')?.errors?.['required']) {
                  <span i18n="@@householdSettings.nameRequired">Husholdningsnavn er pakrevd</span>
                }
                @if (householdForm.get('name')?.errors?.['maxlength']) {
                  <span i18n="@@householdSettings.nameMaxLength"
                    >Husholdningsnavn ma vaere under 100 tegn</span
                  >
                }
              </div>
            }
          </div>

          @if (!isAdmin()) {
            <div class="info-message" role="status">
              <p i18n="@@householdSettings.adminOnlyMessage">
                Kun husholdningsadministratorer kan redigere husholdningsdetaljer.
              </p>
            </div>
          }

          @if (isAdmin()) {
            <div class="form-actions">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="householdForm.invalid || isSaving()"
                [attr.aria-busy]="isSaving()"
              >
                @if (isSaving()) {
                  <span i18n="@@householdSettings.savingButton">Lagrer...</span>
                } @else {
                  <span i18n="@@householdSettings.saveButton">Lagre endringer</span>
                }
              </button>
            </div>
          }
        </form>
      </section>

      <!-- Members Section -->
      <section class="settings-section">
        <h2 i18n="@@householdSettings.membersTitle">Husholdningsmedlemmer</h2>

        @if (isAdmin()) {
          <div class="section-actions">
            <app-invite-user
              [householdId]="household()!.id"
              (invitationSent)="onInvitationSent()"
            />
          </div>

          <app-invitations-sent-list />
        }

        @if (members().length > 0) {
          <ul class="members-list" role="list">
            @for (member of members(); track member.userId) {
              <li class="member-item">
                <div class="member-info">
                  <span class="member-name">
                    {{ member.displayName || member.email }}
                  </span>
                  <span
                    class="member-role"
                    [class.member-role--parent]="member.role === 'parent'"
                    [class.member-role--child]="member.role === 'child'"
                  >
                    {{ member.role }}
                  </span>
                </div>
                <div class="member-meta">
                  <span class="member-email">{{ member.email }}</span>
                  <span class="member-joined" i18n="@@householdSettings.joinedDate">
                    Ble med {{ member.joinedAt | date: 'mediumDate' }}
                  </span>
                </div>
              </li>
            }
          </ul>
        } @else {
          <p class="empty-state" i18n="@@householdSettings.noMembers">Ingen medlemmer funnet.</p>
        }
      </section>

      <!-- Children Section -->
      <section class="settings-section">
        <h2 i18n="@@householdSettings.childrenTitle">Barn</h2>
        <p class="section-description" i18n="@@householdSettings.childrenDescription">
          Administrer barn i husholdningen din.
        </p>
        <app-children-management />
      </section>
    </div>

    @if (successMessage()) {
      <div class="alert alert--success" role="status" aria-live="polite">
        {{ successMessage() }}
      </div>
    }

    @if (errorMessage()) {
      <div class="alert alert--error" role="alert" aria-live="polite">
        {{ errorMessage() }}
      </div>
    }
  }
</div>
