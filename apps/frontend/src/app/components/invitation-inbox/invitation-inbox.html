<div
  class="invitation-inbox"
  role="region"
  i18n-aria-label="@@invitationInbox.region"
  aria-label="Innboks for invitasjoner"
>
  <div class="header">
    <h2 id="inbox-title">
      <ng-container i18n="@@invitationInbox.title">Invitasjonsinnboks</ng-container>
      @if (pendingCount > 0) {
        <span class="badge badge-count" [attr.aria-label]="pendingCount + ' ventende invitasjoner'">
          {{ pendingCount }}
        </span>
      }
    </h2>
    <button
      type="button"
      class="btn btn-secondary"
      (click)="loadInvitations()"
      [disabled]="isLoading()"
      i18n-aria-label="@@invitationInbox.refreshAria"
      aria-label="Oppdater invitasjoner"
      i18n="@@invitationInbox.refresh"
    >
      Oppdater
    </button>
  </div>

  <!-- Success message -->
  @if (successMessage()) {
    <div class="alert alert-success" role="alert" aria-live="polite">
      {{ successMessage() }}
    </div>
  }

  <!-- Error message -->
  @if (errorMessage()) {
    <div class="alert alert-error" role="alert" aria-live="assertive">
      {{ errorMessage() }}
    </div>
  }

  <!-- Loading state -->
  @if (isLoading()) {
    <div class="loading" role="status" aria-live="polite">
      <span aria-hidden="true">⏳</span>
      <ng-container i18n="@@invitationInbox.loading">Laster invitasjoner...</ng-container>
    </div>
  }

  <!-- Empty state -->
  @if (!isLoading() && invitations().length === 0) {
    <div class="empty-state" role="status">
      <p i18n="@@invitationInbox.noInvitations">Ingen ventende invitasjoner.</p>
      <p i18n="@@invitationInbox.emptyStateHint">
        Når noen inviterer deg til å bli med i husstanden deres, vil det vises her.
      </p>
    </div>
  }

  <!-- Invitations list -->
  @if (!isLoading() && invitations().length > 0) {
    <ul class="invitations-list" aria-labelledby="inbox-title" role="list">
      @for (invitation of invitations(); track invitation.id) {
        <li class="invitation-card" [class.expired]="isExpired(invitation)">
          <div class="invitation-details">
            <h3 class="household-name">
              {{ invitation.householdName || 'Ukjent husstand' }}
            </h3>
            <p class="inviter">
              <ng-container i18n="@@invitationInbox.invitedBy">Invitert av:</ng-container>
              {{ invitation.inviterName || invitation.inviterEmail || 'Ukjent' }}
            </p>
            <p class="role">
              <ng-container i18n="@@invitationInbox.role">Rolle:</ng-container>
              <strong>{{ invitation.role | titlecase }}</strong>
            </p>
            <p class="dates">
              <ng-container i18n="@@invitationInbox.sent">Sendt:</ng-container>
              {{ invitation.createdAt | date: 'mediumDate' }}
              <span class="separator">•</span>
              @if (isExpired(invitation)) {
                <span class="text-danger" i18n="@@invitationInbox.expired">Utløpt</span>
              } @else {
                <ng-container i18n="@@invitationInbox.expires">Utløper:</ng-container>
                {{ invitation.expiresAt | date: 'mediumDate' }}
              }
            </p>
          </div>

          <div class="invitation-actions">
            @if (isExpired(invitation)) {
              <span
                class="expired-badge"
                i18n-aria-label="@@invitationInbox.expiredAria"
                aria-label="Denne invitasjonen har utløpt"
                i18n="@@invitationInbox.expiredBadge"
              >
                Utløpt
              </span>
            } @else {
              <button
                type="button"
                class="btn btn-primary"
                (click)="acceptInvitation(invitation)"
                [disabled]="isProcessing(invitation)"
                [attr.aria-label]="
                  'Godta invitasjon til å bli med i ' + (invitation.householdName || 'husstand')
                "
                [attr.aria-busy]="isProcessing(invitation)"
              >
                @if (isProcessing(invitation)) {
                  <ng-container i18n="@@invitationInbox.accepting">Godtar...</ng-container>
                } @else {
                  <ng-container i18n="@@invitationInbox.accept">Godta</ng-container>
                }
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                (click)="declineInvitation(invitation)"
                [disabled]="isProcessing(invitation)"
                [attr.aria-label]="
                  'Avslå invitasjon til å bli med i ' + (invitation.householdName || 'husstand')
                "
                [attr.aria-busy]="isProcessing(invitation)"
              >
                @if (isProcessing(invitation)) {
                  <ng-container i18n="@@invitationInbox.declining">Avslår...</ng-container>
                } @else {
                  <ng-container i18n="@@invitationInbox.decline">Avslå</ng-container>
                }
              </button>
            }
          </div>
        </li>
      }
    </ul>
  }
</div>
