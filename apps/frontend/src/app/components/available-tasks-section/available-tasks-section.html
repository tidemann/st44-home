<div class="available-tasks-section">
  <h2 class="section-title" i18n="@@availableTasks.title">Tilgjengelige oppgaver</h2>

  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p i18n="@@availableTasks.loading">Laster tilgjengelige oppgaver...</p>
    </div>
  }

  @if (error()) {
    <div class="error-message">
      {{ error() }}
    </div>
  }

  @if (actionError()) {
    <div class="action-error">
      {{ actionError() }}
    </div>
  }

  @if (!loading() && !hasTasks()) {
    <div class="empty-state">
      <p i18n="@@availableTasks.noTasks">Ingen oppgaver tilgjengelig for deg akkurat na.</p>
      <p class="empty-state-hint" i18n="@@availableTasks.checkBackLater">
        Sjekk tilbake senere eller spor foreldrene dine!
      </p>
    </div>
  }

  @if (hasTasks()) {
    <div class="tasks-list">
      @for (task of tasks(); track task.id) {
        <div class="task-card" [class.processing]="isTaskProcessing(task.id)">
          <div class="task-header">
            <h3 class="task-name">{{ task.name }}</h3>
            <span class="task-points" i18n="@@availableTasks.points">{{ task.points }} poeng</span>
          </div>

          @if (task.description) {
            <p class="task-description">{{ task.description }}</p>
          }

          <div class="task-meta">
            @if (task.hasDeadline) {
              <span class="deadline-badge" [class.urgent]="isDeadlineUrgent(task)">
                {{ getDeadlineText(task) }}
              </span>
            }
            @if (task.candidateCount > 1) {
              <span class="candidates-badge" i18n="@@availableTasks.candidates">
                {{ task.candidateCount }} kandidater
              </span>
            }
          </div>

          <div class="task-actions">
            <button
              class="btn btn-accept"
              (click)="onAccept(task)"
              [disabled]="isProcessing()"
              type="button"
            >
              @if (isTaskProcessing(task.id)) {
                <span class="btn-spinner"></span>
                <ng-container i18n="@@availableTasks.accepting">Aksepterer...</ng-container>
              } @else {
                <ng-container i18n="@@availableTasks.accept">✓ Aksepter</ng-container>
              }
            </button>

            <button
              class="btn btn-decline"
              (click)="onDecline(task)"
              [disabled]="isProcessing()"
              type="button"
            >
              @if (isTaskProcessing(task.id)) {
                <span class="btn-spinner"></span>
                <ng-container i18n="@@availableTasks.declining">Avviser...</ng-container>
              } @else {
                <ng-container i18n="@@availableTasks.decline">✗ Avvis</ng-container>
              }
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
