<div class="child-task-list">
  <header class="header">
    <h1 i18n="@@childTaskList.title">Mine oppgaver</h1>
    <div class="filter-buttons">
      <button
        class="filter-btn"
        [class.active]="dateFilter() === 'today'"
        (click)="filterDate('today')"
        i18n-aria-label="@@childTaskList.showTodayTasks"
        aria-label="Vis dagens oppgaver"
        i18n="@@childTaskList.today"
      >
        I dag
      </button>
      <button
        class="filter-btn"
        [class.active]="dateFilter() === 'week'"
        (click)="filterDate('week')"
        i18n-aria-label="@@childTaskList.showWeekTasks"
        aria-label="Vis denne ukens oppgaver"
        i18n="@@childTaskList.thisWeek"
      >
        Denne uken
      </button>
    </div>
  </header>

  @if (loading()) {
    <div class="loading-state" role="status" aria-live="polite">
      <div class="spinner"></div>
      <p i18n="@@childTaskList.loading">Laster oppgaver...</p>
    </div>
  }

  @if (error()) {
    <div class="error-state" role="alert">
      <p>{{ error() }}</p>
      <button class="retry-btn" (click)="filterDate(dateFilter())" i18n="@@childTaskList.tryAgain">
        PrÃ¸v igjen
      </button>
    </div>
  }

  @if (!loading() && !error()) {
    @if (tasks().length === 0) {
      <div class="empty-state">
        <div class="emoji">ðŸŽ‰</div>
        <h2>
          @if (dateFilter() === 'today') {
            <ng-container i18n="@@childTaskList.noTasksToday">Ingen oppgaver i dag!</ng-container>
          } @else {
            <ng-container i18n="@@childTaskList.noTasksWeek"
              >Ingen oppgaver denne uken!</ng-container
            >
          }
        </h2>
        <p i18n="@@childTaskList.allCaughtUp">Flott jobbet! Du er helt ajour!</p>
      </div>
    } @else {
      <div class="progress-section">
        <div class="progress-text">
          <span class="completed">{{ completedCount() }}</span>
          <span class="divider" i18n="@@childTaskList.of">av</span>
          <span class="total">{{ tasks().length }}</span>
          <span class="label" i18n="@@childTaskList.complete">fullfÃ¸rt</span>
        </div>
        <div class="progress-bar-container">
          <div
            class="progress-bar"
            role="progressbar"
            [attr.aria-valuenow]="completedCount()"
            [attr.aria-valuemin]="0"
            [attr.aria-valuemax]="tasks().length"
            [attr.aria-label]="completedCount() + ' av ' + tasks().length + ' oppgaver fullfÃ¸rt'"
            [style.width.%]="progressPercent()"
          ></div>
        </div>
        @if (progressPercent() === 100) {
          <div class="congrats-message" i18n="@@childTaskList.allDone">
            ðŸŒŸ Alt gjort! Fantastisk innsats!
          </div>
        }
      </div>

      <div class="task-list">
        @for (task of tasks(); track task.id) {
          <app-task-card [task]="task" (complete)="onComplete($event)" />
        }
      </div>
    }
  }
</div>
