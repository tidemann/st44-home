<app-modal
  [open]="open()"
  (closeModal)="onClose()"
  i18n-title="@@quickAddModal.title"
  title="Hurtiglegg til daglig oppgave"
>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label class="form-label" for="task-name" i18n="@@quickAddModal.taskNameLabel"
        >Oppgavenavn *</label
      >
      <input
        type="text"
        id="task-name"
        class="form-input"
        formControlName="name"
        i18n-placeholder="@@quickAddModal.taskNamePlaceholder"
        placeholder="f.eks. Ta ut søpla"
        [class.error]="form.controls.name.invalid && form.controls.name.touched"
        [attr.aria-invalid]="form.controls.name.invalid && form.controls.name.touched"
        [attr.aria-describedby]="
          form.controls.name.invalid && form.controls.name.touched ? 'task-name-error' : null
        "
      />
      @if (form.controls.name.invalid && form.controls.name.touched) {
        <div id="task-name-error" class="form-error" role="alert">
          @if (form.controls.name.errors?.['required']) {
            <span i18n="@@quickAddModal.taskNameRequired">Oppgavenavn er obligatorisk</span>
          }
          @if (form.controls.name.errors?.['maxlength']) {
            <span i18n="@@quickAddModal.taskNameTooLong"
              >Oppgavenavnet er for langt (maks 255 tegn)</span
            >
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label class="form-label" for="assign-to" i18n="@@quickAddModal.assignToLabel"
        >Tildel til *</label
      >
      <select
        id="assign-to"
        class="form-select"
        formControlName="assignedChildId"
        [class.error]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
        "
        [attr.aria-invalid]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
        "
        [attr.aria-describedby]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
            ? 'assign-to-error'
            : null
        "
      >
        <option value="" i18n="@@quickAddModal.choosePerson">Velg person...</option>
        @for (child of children(); track child.id) {
          <option [value]="child.id">{{ child.name }}</option>
        }
      </select>
      @if (form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched) {
        <div
          id="assign-to-error"
          class="form-error"
          role="alert"
          i18n="@@quickAddModal.selectAssignee"
        >
          Vennligst velg hvem som skal tildeles denne oppgaven
        </div>
      }
    </div>

    <div class="form-group">
      <label class="form-label" for="points" i18n="@@quickAddModal.pointsLabel">Poeng</label>
      <input
        type="number"
        id="points"
        class="form-input"
        formControlName="points"
        min="1"
        max="1000"
        [class.error]="form.controls.points.invalid && form.controls.points.touched"
        [attr.aria-invalid]="form.controls.points.invalid && form.controls.points.touched"
        [attr.aria-describedby]="
          form.controls.points.invalid && form.controls.points.touched ? 'points-error' : null
        "
      />
      @if (form.controls.points.invalid && form.controls.points.touched) {
        <div id="points-error" class="form-error" role="alert">
          @if (form.controls.points.errors?.['min']) {
            <span i18n="@@quickAddModal.pointsMin">Poeng må være minst 1</span>
          }
          @if (form.controls.points.errors?.['max']) {
            <span i18n="@@quickAddModal.pointsMax">Poeng må være maks 1000</span>
          }
        </div>
      }
    </div>

    <div class="modal-actions" modal-actions>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        i18n="@@quickAddModal.cancelButton"
      >
        Avbryt
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="form.invalid || submitting()"
        i18n="@@quickAddModal.submitButton"
      >
        Opprett
      </button>
    </div>
  </form>
</app-modal>
