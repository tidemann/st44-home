<app-modal [open]="open()" (closeModal)="onClose()" title="Quick Add Task">
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label class="form-label" for="task-name">Task Name *</label>
      <input
        type="text"
        id="task-name"
        class="form-input"
        formControlName="name"
        placeholder="e.g., Take out trash"
        [class.error]="form.controls.name.invalid && form.controls.name.touched"
        [attr.aria-invalid]="form.controls.name.invalid && form.controls.name.touched"
        [attr.aria-describedby]="
          form.controls.name.invalid && form.controls.name.touched ? 'task-name-error' : null
        "
      />
      @if (form.controls.name.invalid && form.controls.name.touched) {
        <div id="task-name-error" class="form-error" role="alert">
          @if (form.controls.name.errors?.['required']) {
            Task name is required
          }
          @if (form.controls.name.errors?.['maxlength']) {
            Task name is too long (max 255 characters)
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label class="form-label" for="assign-to">Assign to *</label>
      <select
        id="assign-to"
        class="form-select"
        formControlName="assignedChildId"
        [class.error]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
        "
        [attr.aria-invalid]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
        "
        [attr.aria-describedby]="
          form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched
            ? 'assign-to-error'
            : null
        "
      >
        <option value="">Choose person...</option>
        @for (child of children(); track child.id) {
          <option [value]="child.id">{{ child.name }}</option>
        }
      </select>
      @if (form.controls.assignedChildId.invalid && form.controls.assignedChildId.touched) {
        <div id="assign-to-error" class="form-error" role="alert">
          Please select who to assign this task to
        </div>
      }
    </div>

    <div class="form-group">
      <label class="form-label" for="points">Points</label>
      <input
        type="number"
        id="points"
        class="form-input"
        formControlName="points"
        min="1"
        max="1000"
        [class.error]="form.controls.points.invalid && form.controls.points.touched"
        [attr.aria-invalid]="form.controls.points.invalid && form.controls.points.touched"
        [attr.aria-describedby]="
          form.controls.points.invalid && form.controls.points.touched ? 'points-error' : null
        "
      />
      @if (form.controls.points.invalid && form.controls.points.touched) {
        <div id="points-error" class="form-error" role="alert">
          @if (form.controls.points.errors?.['min']) {
            Points must be at least 1
          }
          @if (form.controls.points.errors?.['max']) {
            Points must be at most 1000
          }
        </div>
      }
    </div>

    <div class="modal-actions" modal-actions>
      <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="form.invalid || submitting()">
        Create
      </button>
    </div>
  </form>
</app-modal>
